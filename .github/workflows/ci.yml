name: CI

on:
  push:
    branches:
      - main

  # Run tests for any PRs.
  pull_request:

jobs:
  linter:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # OR "2" -> To retrieve the preceding commit.

      - name: Get ruby changed files
        id: ruby-changed-files
        uses: tj-actions/changed-files@v33
        with:
          files: |
            **/*.rb

      - name: Run ruby linters if any file changed
        if: steps.ruby-changed-files.outputs.any_changed == 'true'
        run: |
          echo "Run rubobop and reek"
          echo "List all the files that have changed: ${{ steps.changed-files.outputs.all_changed_files }}"

      - name: Get haml changed files
        id: haml-changed-files
        uses: tj-actions/changed-files@v33
        with:
          files: |
            **/*.haml

      - name: Run haml linter if any file changed
        if: steps.haml-changed-files.outputs.any_changed == 'true'
        run: |
          echo "Run haml-lin"
          echo "List all the files that have changed: ${{ steps.changed-files.outputs.all_changed_files }}"
  # test:
  #   runs-on: ubuntu-latest

  #   steps:
  #     - uses: actions/checkout@v2

  #     - name: Build docker
  #       run: |
  #         docker-compose build
  #     - name: Setup test database
  #       run: |
  #         docker-compose run --rm api rails db:setup RAILS_ENV=test
  #     - name: Run tests
  #       run: |
  #         docker-compose run --rm api rspec
